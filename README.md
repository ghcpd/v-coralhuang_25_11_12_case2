# Weatherbot UI Repair - Chat UI Fix

Overview
- This project fixes layout, media, and header stability issues in the reference `input.html` chat UI.
- The fixed artifact is `ui_fixed.html`, together with `styles.css` and `app.js`.
- Local validation uses Playwright and BeautifulSoup with `test_validator.py`.

Quick start
1. Install dependencies:
   - Linux/macOS: python3 -m pip install -r requirements.txt
   - Windows: py -m pip install -r requirements.txt
2. Install Playwright browsers (once): `python -m playwright install`
3. Run local test server and validator:
   - Linux/macOS: `./run_test.sh`
   - Windows: `run_test.bat`

What I fixed
- Layout overlaps: replaced `position:absolute` with a flexbox layout for `.message`; bubbles are in normal flow and aligned left/right with `align-self`.
- Anchored avatars: `avatar` elements are inside message bubbles and are anchored via `display:flex`.
- Media distortion: removed forced 90deg rotation; added `transform:none` and handled naturalWidth/naturalHeight to preserve aspect ratio and clamping rules that prevent overgrowth.
- Time header flicker: switched to unique, non-animated headers with `role=separator` and `aria-label`; insertions are done with minimal DOM updates and scroll adjustments to preserve anchors.
- Scroll/stability: insertion functions preserve scroll position when inserting at the top and keep the bottom stickiness behavior.
- Accessibility: added roles, aria-labels, and alt attributes across images.

How validation works
- `test_validator.py` performs both static DOM checks (via BeautifulSoup) and runtime checks (via Playwright):
  - No `.message` overlaps while rapidly scrolling (pairwise BCR tests)
  - No CSS transforms rotating images
  - Media aspect ratio preserved within 2% of natural ratio or clamped appropriately
  - Time headers are stable when new headers/messages are inserted
  - Accessibility smoke tests (no duplicate IDs, roles, and alt attributes)

Known limitations
- The test uses a headless Chromium via Playwright; first-time run may download browsers.
- The validator heuristics sample only a few scroll samples; pathological CSS or timing-sensitive race conditions may require additional test iterations.

Files
- `ui_fixed.html` - fixed UI
- `styles.css` - CSS
- `app.js` - JS logic with minimal DOM updates and `window.simulateInsertOnce` for tests
- `test_validator.py` - validator harness
- `run_test.sh` / `run_test.bat` - OS-specific scripts to start server and run tests
- `requirements.txt` - Python dependencies
- `artifacts/` - output artifacts, generated by test scripts

